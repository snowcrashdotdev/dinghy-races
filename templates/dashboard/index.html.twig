{% extends 'base.html.twig' %}

{% block title %}Dashboard{% endblock %}

{% block body %}
<header>
     <h1>Dashboard</h1>
     <p>Welcome, {{user.username}}</p>
</header>

<main>
    {% set happening_now = user.tournaments|filter(t => t.inProgress) %}
    {% if happening_now|length %}
        <h2>Happening now:</h2>
        {% for tournament in happening_now %}
            <section class="border-left">
                {% set href = path('tournament_show', {
                    'id': tournament.id
                }) %}
                <h3>
                    <a href="{{href}}">{{tournament.title}}</a>
                    <small>(ends: {{tournament.endDate|date_modify('-1 minute')|date}})</small>
                </h3>
                <section class="summary-group">
                {% for game in tournament.games %}
                    {{ include('game/_summary.html.twig', {
                        'tournament': tournament,
                        'game': game,
                        'high_score': tournament.scores|filter(s => s.game is same as(game))|first,
                        'user_score': user.tournamentScores|filter(s => s.tournament is same as(tournament) and s.game is same as(game))|first
                    }) }}
                {% endfor %}
                </section>
            </section>
        {% endfor %}
    {% endif %}

    {% set upcoming = user.tournaments|filter(t => t.upcoming) %}
    {% if upcoming|length %}
        <h2>Upcoming:</h2>
        {% for tournament in upcoming %}
            <section class="border-left">
                {{ include('tournament/_summary.html.twig', {
                    'tournament': tournament,
                    'show_description': true
                }) }}
            </section>
        {% endfor %}
    {% endif %}
</main>
{% endblock %}
