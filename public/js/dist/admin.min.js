function addGameToCollection(json,resultList){let gameCollection=document.getElementById("game_collection_games"),gamePreviews=document.getElementById("game-form-list");for(let result of json){let li=document.createElement("li");li.classList.add("ajax-search-result"),li.classList.add("game-search-result"),li.innerHTML=`${result.description} <small>(${result.name}.zip)</small>`,resultList.appendChild(li),li.addEventListener("click",(function(e){if(!confirm(`Add the game ${result.description} to this tournament?`))return!1;let gameCollectionPlaceholder=document.getElementById("game-form-no-items");gameCollectionPlaceholder&&gameCollectionPlaceholder.remove();let newInput=createNewInput(gameCollection);gameCollection.appendChild(newInput),gameCollection.lastElementChild.value=result.name;let newPreview=document.createElement("span");newPreview.classList.add("game-form-list-item"),newPreview.setAttribute("data-input-id",gameCollection.lastElementChild.id),newPreview.innerText=result.name,newPreview.addEventListener("click",removeGameFromCollection),gamePreviews.appendChild(newPreview),resultList.previousElementSibling.value=""}))}}function removeGameFromCollection(event){let gamePreview=event.target,hiddenInput=document.getElementById(gamePreview.getAttribute("data-input-id"));if(hiddenInput){if(!0===confirm("Do you want to remove this game?")){let gameCollection=gamePreview.parentElement;if(gamePreview.remove(),hiddenInput.value="",gameCollection.children.length<1){let gameCollectionPlaceholder=document.createElement("p");gameCollectionPlaceholder.id="game-form-no-items",gameCollectionPlaceholder.innerText="No games selected.",gameCollection.appendChild(gameCollectionPlaceholder)}}}}function addPlayerToRoster(e){let player=e.target.id;if(!confirm(`Add ${player} to this team?`))return!1;let roster=document.getElementById("team-roster-list"),rosterPlaceholder=document.getElementById("team-roster-placeholder"),rosterForm=document.getElementById("roster_members"),newInput=createNewInput(rosterForm);rosterForm.appendChild(newInput),rosterForm.lastElementChild.value=player;let newRosterItem=document.createElement("span");newRosterItem.classList.add("team-roster-list-item"),newRosterItem.setAttribute("data-input-id",rosterForm.lastElementChild.id),newRosterItem.innerText=player,rosterPlaceholder&&rosterPlaceholder.remove(),roster.appendChild(newRosterItem),newRosterItem.addEventListener("click",openRosterModal),e.target.remove()}function createNewInput(collection){let prototype=collection.getAttribute("data-prototype"),lastChild=collection.lastElementChild,newName=lastChild?getNewItemIndex(lastChild):0,newMarkup=prototype.replace(new RegExp("__name__","g"),newName);return document.createRange().createContextualFragment(newMarkup)}function openRosterModal(e){let rosterListItem=e.target,rosterInputId=rosterListItem.getAttribute("data-input-id"),rosterListInput=document.getElementById(rosterInputId),player=rosterListItem.innerText,modal=document.getElementById("roster-modal"),modal_prime=modal.cloneNode(!0),teamId=modal.getAttribute("data-team-id"),token=modal.getAttribute("data-token"),playerName=document.getElementById("player-name"),playerSend=document.getElementById("player-send"),playerRemove=document.getElementById("player-remove"),teamSelect=document.getElementById("team-select"),buttonClose=modal.firstElementChild,buttonBack=buttonClose.nextElementSibling;function closeRosterModal(){modal.remove(),document.body.classList.remove("modal-open"),document.body.appendChild(modal_prime)}playerName.innerText=player,document.body.classList.add("modal-open"),modal.classList.remove("off-canvas"),modal.removeAttribute("hidden"),playerSend.addEventListener("click",(function(e){e.preventDefault(),buttonBack.removeAttribute("hidden"),this.innerText="send to..",this.style.border="none",this.style.color="white",this.setAttribute("disabled",""),playerRemove.setAttribute("hidden",""),teamSelect.removeAttribute("hidden"),buttonBack.addEventListener("click",(function(e){e.preventDefault(),playerSend.innerText="Send Player",playerSend.removeAttribute("style"),playerSend.removeAttribute("disabled"),playerRemove.removeAttribute("hidden"),teamSelect.setAttribute("hidden",""),this.setAttribute("hidden","")})),teamSelect.addEventListener("change",(function(e){if(this.selectedIndex>0){if(!confirm(`Send ${player} to the selected team?`))return!1;let sendUrl=`/teams/${teamId}/send/${player}/${this.value}`,sendForm=new FormData;sendForm.append("_token",token),window.fetch(sendUrl,{method:"POST",body:sendForm,headers:{"X-Requested-With":"XMLHttpRequest"}}).then((function(res){return res.json()})).then((function(json){json.success?(closeRosterModal(),rosterListItem.remove(),rosterListInput.value="",createFlash("success",json.message)):createFlash("error",json.message)}))}}))})),playerRemove.addEventListener("click",(function(e){if(e.preventDefault(),!confirm(`Remove ${player} from team?`))return!1;let eligibleListItem=document.createElement("span"),eligiblePlayersList=document.getElementById("eligible-players-list");eligibleListItem.id=player,eligibleListItem.innerText=player,eligibleListItem.addEventListener("click",addPlayerToRoster),eligibleListItem.classList.add("eligible-players-list-item"),rosterListInput.value="",rosterListItem.remove(),eligiblePlayersList.appendChild(eligibleListItem),closeRosterModal()})),buttonClose.addEventListener("click",closeRosterModal)}function getNewItemIndex(el){return Number(el.id.split("_").slice(-1))+1}function createFlash(key,message){let flashBag=document.getElementById("flash-bag"),div=document.createElement("div");div.classList.add("flash"),div.classList.add("flash-"+key),div.innerText=message,flashBag.appendChild(div),function showFlashBag(){flashBag.removeAttribute("hidden"),flashBag.classList.remove("fade")}(),function fadeFlashBag(){flashBag.childElementCount>0&&setTimeout((function(){flashBag.classList.add("fade"),setTimeout((function(){removeAllChildren(flashBag),flashBag.setAttribute("hidden","")}),1e3)}),6e3)}()}function removeAllChildren(el){for(;el.hasChildNodes();)el.removeChild(el.lastChild)}document.addEventListener("DOMContentLoaded",(function(){let gameCollectionItems=document.getElementsByClassName("game-form-list-item");for(let item of gameCollectionItems)item.addEventListener("click",removeGameFromCollection)})),document.addEventListener("DOMContentLoaded",(function(){let eligiblePlayersInput=document.getElementById("eligible-players"),eligiblePlayersData=eligiblePlayersInput?eligiblePlayersInput.getAttribute("data-eligible-players"):null;if(eligiblePlayersData){let eligiblePlayers=JSON.parse(eligiblePlayersData),eligilbePlayersList=document.getElementById("eligible-players-list");for(player of eligiblePlayers){let listItem=document.createElement("span");listItem.id=player.username,listItem.innerText=player.username,listItem.classList.add("eligible-players-list-item"),listItem.addEventListener("click",addPlayerToRoster),eligilbePlayersList.appendChild(listItem)}}let rosterListItems=document.getElementsByClassName("team-roster-list-item");for(let item of rosterListItems)item.addEventListener("click",openRosterModal)})),document.addEventListener("DOMContentLoaded",(function(){let ajaxForms=document.getElementsByClassName("ajax-form");for(let form of ajaxForms)form.addEventListener("submit",(function(e){e.preventDefault();const formData=new FormData(this);window.fetch(this.action,{method:this.method,body:formData,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(res=>res.json()).then(json=>{json.success?createFlash("success",json.message):createFlash("error",json.message)})}))}));